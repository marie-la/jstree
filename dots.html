<body>
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script>
      var diameter = 500;
      var tree = d3.layout.tree()
       .size([360, diameter / 2 - 120])
       .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });

      var circleRadii = [40];
      var rootRadius = 40;

      var svgContainer = d3.select("body").append("svg").attr("width", 1000).attr("height", 800);

      var circles = svgContainer.selectAll("circle")
                            .data(circleRadii)
                            .enter()
                            .append("circle")    
      var circleAttributes = circles
         .attr("cx", 500)
         .attr("opacity", 1)
         .attr("cy", function (d, i) {
            return 780-i*100;
         })
         .attr("r", function (d) { return d; })
         .style("fill", function(d) {
           var returnColor;
           if (d === 40) { returnColor = "black";
           } else if (d === 20) { returnColor = "purple";
           } else if (d === 10) { returnColor = "red"; }
           return returnColor;
         });
      generate(circles[0][0]);

//Given circle generate some more circles
      function generate(node) {
        var roll = Math.random();
        var radius = node.attributes.r.value;
        if (radius < 4) { return;
        } if (roll < .2) { 
          return;
        } 
        console.log("recursed!");
        var numBranch = rollToBranch(roll,radius);
        console.log(numBranch);
        for (var i = 0; i <= numBranch; i++) {
          var newNode = svgContainer.append("circle")
            .attr("cx", Number(node.attributes.cx.value) + Number(Math.random()-.5)*100*(radius/rootRadius)*numBranch)
            .attr("cy", Number(node.attributes.cy.value) + Number((Math.random()-.2)*35) - Number(node.attributes.r.value)*2-10)
            .attr("r", node.attributes.r.value/1.2)
            .attr("opacity", node.attributes.opacity.value/1.1);
            console.log("should recurse here");
          generate(newNode[0][0]);
        }
      }

      function rollToBranch(roll,r) {
        if (roll < .3) { return 0;
        } else if (roll < .9) { return 1;
        } else if (roll < .96) { return 2;
        } else return 3;
      }

  </script>
</body>
